\chapter{Introduction}

The emergence of SARS-CoV-2, the virus behind COVID-19, has drastically changed our world, affecting health, economies, and daily life. 
First identified in late 2019, this virus quickly spread globally, triggering a pandemic that has impacted millions.

The pandemic had been characterized by recurrent waves of infection, driven by genetic variants such as the Alpha, Beta, Delta, and Omicron variants. \cite{tegally2021detection, Volz2021, vohringer2021genomic, Earnest2021}

Even following the end of the pandemic, there have been multiple infection waves caused by seasonality in transmission as well as evolution of novel SARS-CoV-2 variants that can evade existing immune responses in individuals with past exposure. 

Immune escape driven by antigenic evolution has motivated annual updates to the COVID-19 vaccine to better protect individuals with weakened immune systems and those without past or recent exposure.

Evolution in SARS-CoV-2 has produced genetic variants that exhibit strain-specific immune responses in humans as measured through serology, neutralization titers, and deep mutational scanning assays. \cite{Bekliz2024, Jian2023, Dadonaite2023, Voss2024}

Therefore, understanding both the virus's evolution and transmission dynamics are crucial for managing the pandemic and crafting effective public health strategies.
As SARS-CoV-2 continues to spread, the virus will mutate and new variants with unique traits emerge, influencing their transmissibility, severity, and ability to evade immunity.
% This constantly shifting landscape underscores the importance of forecasting the emergence and spread of these viral variants.

Novel genetic variants often arise due to mutations in currently circulating virus populations.
These mutations can sometimes provide fitness advantages to members of the population allowing them to out-compete other variants through mechanisms such as partial immune escape, increased transmissibility, among others.
This interplay of mutation, transmission, and selection leads to evolution in the population.
Therefore, understanding the genetic composition of viral populations and its relation to virus phenotype can be useful for understanding the current and future epidemic potential of viral variants.

Forecasting these variants is essential for predicting future infection waves, guiding public health measures, and informing vaccine development.
However, this task is challenging due to the virus's rapid mutation rate and the dynamic nature of human immunity and behavior. 

Accurate models are needed to predict how these variants will evolve and spread, to monitor SARS-CoV-2 evolution, and to mitigate future outbreaks.

%TODO: Though SARS-CoV-2 is the primary focus of this dissertation. These methods should generalize.

\paragraph{Objectives and problem statement}

The primary objective of this dissertation is to develop and evaluate models that accurately forecast the evolution and spread of SARS-CoV-2 variants. This involves integrating concepts from epidemiology, evolutionary biology, and applied mathematics to create a comprehensive framework for understanding viral dynamics.

One of the fundamental challenges in forecasting SARS-CoV-2 variants is accounting for the virus's rapid mutation rate and its interaction with the human immune system. Mutations can lead to new variants with increased transmissibility or the ability to evade immunity. To address this, it is essential to incorporate mathematical models that can capture the complexities of viral evolution and spread.

In order to contextualize this work, I will begin with an overview of existing methods for understanding infectious disease transmission, relevant epidemiological quantities, and their relationships to one another.

%TODO: Extend this section, we really also want to menion effective population size, genetic drift .etc
I will then discuss existing methods for understanding population turnover from population genetics and their relationship to some of the related quantities in the epidemiological context.

I will then provide an overview of Bayesian inference, model development, and optimization methods that will be used throughout this dissertation to estimate quantities from data and make predictions while quantifying uncertainty.

Lastly, I will end this introduction by discussing the larger problem of evolutionary forecasting: its components, its aims, and the benefits of developing data-driven evolutionary forecasts on a global scale.
%TODO: This should really end with a description of my contributions.

% My interest is in modeling the epidemic and evolutionary dynamics of virus transmission jointly to better understand how and why virus populations change over time and the consequences of this on human health.
%
% Ultimately, I would like to assess the potential for joint epidemic and evolutionary models to forecast the genetic composition of virus population in the future.
% This may be particularly useful for vaccine strain selection for seasonal influenza and SARS-CoV-2.
%
% To start, I will introduce several preliminary mathematical, biological, and statistical concepts and results needed to re-frame these aims as concrete goals.
%
\section{Epidemic models}

I will give a basic introduction of the ordinary differential equation (ODE) formulation of epidemic models.
We begin with the classic SIR model \cite{KermackMcKendrick1927}.

We will assume that there are three types of individuals in the population: susceptible ($S$), infected ($I$), and recovered ($R$). 
Susceptible individuals can become infected, infected individuals eventually recover (or die), and recovered individuals cannot become infected once again. 
This gives us the system of equations
\begin{align}
  \frac{d S}{d t} &= - \beta S I,\\ 
  \frac{d I}{d t} &= \beta S I - \gamma I,\\
  \frac{d R}{d t} &= \gamma I,
\end{align}
where $\beta$ is an effective infectious contact rate, $\gamma$ is a recovery rate. 
This form of the model lends itself to a couple of analyses that will become important as we extend these models to more complicated infection dynamics.

\paragraph{Effective reproduction number}%

An important quantity that is derived from epidemic models is the effective reproduction number $R_t$. 
We can see that when $R_{t} = \beta S(t) / \gamma > 1$, the number of infected individuals will be increasing, i.e., $\frac{dI}{dt} > 0$. 
This effective reproduction $R_{t}$ controls the direction of the epidemic and reflects the average number of secondary infections caused by a single infection.
In the special case where the population is fully susceptible ($S(t) = 1$), this quantity is called the basic reproduction number $R_{0}$, and it is interpreted as the average number of secondary infections caused by a single individual in an otherwise completely susceptible (naive) population.

% \paragraph{Infectious period}
%
% The second analysis answers the question of how long individuals stay infected under this model. One can show that from the point of infection an individuals rate of becoming uninfectious is constant which implies that the total time spent infected follows an exponential distribution with mean $\tau = \frac{1}{\gamma}$.
%
% Using these facts, we can re-write the differential equation for $I$ as
% \begin{align}
%   \frac{dI}{dt} &= \tau^{-1} (R_{t} - 1)I = r(t) I.
% \end{align}
% Recognizing the differential equation above as that of a time-inhomogeneous exponential growth. 
% We notice that the timing of infectiousness and the effective reproduction number jointly determine the exponential growth rate in an epidemic. 
% In particular, this ODE formulation corresponds to the assumption that the timing between these infections has an exponential distribution. 
% This relationship between timing of reproduction and magnitude of reproduction can be shown more generally.
% %TODO: Though there are ways to generalize this exponential distributed infectious period in the ODE framework, we'll opt for the more general age-structured population dynamic approach.
% %TODO: Mention that generation time and R are needed to make sense of (persistence potential of) exponential growth
% %TODO: Show that this is is not generally true.
%
% \paragraph{Relating effective reproduction number and infection timing}%
%
% We'll also consider more explicitly age-structured transmission models such as renewal equation based models.
%
% In these models, we have that incidence follows
% \begin{align}
%   I(t) = R_{t} \int_{0}^{t} I(t-\tau) g(\tau) d\tau,
% \end{align}
% where $g$ is the density of the generation time $G$ i.e. the timing between primary and secondary infections which acts as a form of the relative transmissibility over the course of an infection.
% We can derive the $R_{t}$ from an age structured population with exponential growth rate $r$ and generation time $G$ as
% \begin{align}
%   \frac{1}{R_{t}} &= \int_{\bbR^{+}} e^{-r\tau} g(\tau) d\tau\\
%                   &=\mathcal{L}_{G}(r) = M_{G}(-r),
% \end{align}
% where we've written the above in terms of a Laplace transform $\mathcal{L}_{G}$ or the moment generating function of $M_{G}$ of the generation time.
% This relationship between $r$ and $R$ can be computed in closed form for several distributions such as the exponential and Gamma \cite{Wallinga2006}.
% For general generation times, we can re-write this in terms of the cumulant generating function of $G$ $K_{G}$ to give the following relationship in terms of moments of $G$, $r$, and $R_{t}$
% \begin{align}
%   \log R_{t} = &- K(-r) \approx \Expect[G] r - \Var[G] \frac{r^{2}}{2} + \left( \Var[G]^{3 / 2} \text{Skew}[G]\right) \frac{r^{3}}{6} + o(r^{4}). \label{eq:central_moment_R}
% \end{align}
%
% Here, it becomes clear that timing of infection and infectiousness is important for interpreting exponential growth rates in terms of the ``average'' transmission dynamics or $R_{t}$ in a population.
%
% We can partially remedy this within the ODE approach by using the "chain trick" in which we allow the infectious individual to remain infectious for non-exponentially generated time period by having multiple sequentially-chained infectious compartments with recover rates $n\gamma$, meaning we replace
% \begin{align*}
%   \frac{d I_{1}}{d t}  &= \beta S \sum_{k=1}^{n} I_{k} - \gamma I_{1}\\
%   \frac{d I_{i}}{d t}  &= n\gamma I_{i-1}- n\gamma I_{i}, \quad 2\leq i \leq n\\
%   \frac{d R}{dt} &= n \gamma I_{n}
% \end{align*}
% In this case, the infectious period is $\text{Gamma}(n, n\gamma)$ distributed with mean $\gamma^{-1}$ and variance. This follows as the infectious period is now the sum of $n$ IID $\text{Exp}(n\gamma)$ random variables. 

% Large $n$ required for complicated serial intervals. Is there a timing first approach.

% More complex models. Specifically allowing us to test various mechanisms for transmission

% Computing $R$ and $R_{0}$. Reference next generation matrix approach here?


% Underlying assumptions of these models with respect to timing on infections. Chain trick as remedy here, reference data showing that these serial intervals are non-exponential to satisfy Mark?
% R, Rt, and methods for estimating R from incidence data?

\section{Multistrain models}

We'll now dive further into the evolutionary component of these models. 
In order for evolution to occur, we need a balance of mutation (generating heritable diversity) and selection (differential survival and reproduction based on that diversity).

For the goal of evolutionary forecasting of virus strains, we need to develop a notion of a multistrain model.
These models will describes population with different types of infecting strains whose differences are heritable.
This enables selection for different strains over time.

\paragraph{A two-strain epidemic model}%

We first consider a standard ODE-based model for infectious diseases with multiple variants: an SIR model in which there are a wild-type $\text{wt}$ and a variant $\text{var}$.
We assume that the variant virus can differ in two ways from the wild type: it may differ in innate transmissibility by a factor of $\eta_{T}$, or it may differ in its infectious period by a factor $\eta_{G}$.
This gives us the system of ordinary differential equations
\begin{align}
  \frac{d S}{d t} &= - \beta S I_{\text{wt}} - \beta \eta_{T} S I_{\text{var}},\\
  \frac{d I_{\text{wt}} }{d t} &= \beta S I_{\text{wt}} - \gamma I_{\text{wt}} = r_{\text{wt}}(t) I_{\text{wt}},\\
  \frac{d I_{\text{var}}}{d t} &= \beta \eta_{T} S I_{\text{var}} - \gamma \eta_{G} I_{\text{var}} = r_{\text{var}}(t) I_{\text{var}}.
\end{align}
% \tbc{Similar comment to in the relative fitness mechanisms manuscript. It's really helpful for my understanding to write out $\phi_\text{wt}$ and $\phi_\text{var}$}.
% MF: I tend to agree but I left it this way since we don't actually discuss anything to do with the $\phi$ here
In this model, we now have two different $R_{0}$ values, $R_{0}^{\text{wt}} = \frac{\beta}{\gamma}$ and $R_{0}^{\text{var}} = \frac{\eta_{T}}{\eta_{G}}R_{0}^{\text{wt}}$.
This shows that there is a dependence between transmissibility and the timing of infections.
If $\eta_{T} > \eta_{G}$, the variant will spread faster than the wildtype, leading to increase in the relative proportion of the variant within the population.

Though this model is not appropriate for infectious diseases with non-trivial competition dynamics via strain-specific immunity for example, it gives us an essential result for epidemiological modeling of genetic variants. \cite{Gog2002}


% More precisely, we notice that without specifying $\eta_{G}$, the variant transmission advantage is unidentifiable.

\section{Population genetics, viral fitness, and selection}

As viruses spread from individual to individual, they generate genetic variation through mutation, drift, and selection.
In the context of ordinary differential equations, we've shown that multiple strains can co-circulate and may dominate one another over time.
However, we still need to develop an understanding of how this co-circulation and transmission affects the underlying population's genetic diversity.

When dealing with pathogens with serial replacement, causing large waves of infection, we're primarily interested in selection.
Selection acts as a ``force'' on the genetic diversity of the population favoring particular genetic variants and causing the population to evolve in response to particular environmental pressures.
We'll now define selection and evolution.

\begin{itemize}
  \item \emph{Selection} is the process by which individuals produce more offspring in certain environments.
% \tbc{this would seem more naturally to me as `leave more offspring' rather than `have higher fitness', although I admit these concepts are synonymous. I just don't think of having higher fitness as a `process'
% MF: Agreed this is more clear.
  \item \emph{Evolution} is the change in the genetic composition of the population over time due to selection, genetic drift, and heritable variation.
    % \tbc{Evolution can also occur due to genetic drift}
    % MF: Tried to change this. I think there's a better way to phrase this however
\end{itemize}

Often, we’re interested in not just the presence of selection but its magnitude.
When quantifying selection in population genetics, the selection coefficient or relative fitness are often discussed.
In the following section, we'll introduce both these quantities and their relationship to one another.

Suppose that we have alleles $A$ and $B$ in a population with $x_A$ individuals having allele $A$ and $x_B$ having allele $B$.
We assume that individuals with alleles $A$ and $B$ produce on average $W_A$ and $W_B$ offspring respectively.
These $W_A$ and $W_B$ are the Wrightian fitness of these alleles.
Assuming that the number of offspring has Poisson distribution with means $W_A$ and $W_B$ respectively, we can write the count of offspring with allele $A$ in the next generation $x_A'$ as

\begin{equation}
x_A' \sim \text{Multinomial}\left(N, \frac{W_A x_A}{W_A x_A + W_B x_B}\right),
\end{equation}
where we've fixed the total number of offspring at $N$.
Using this equation, we can write the expected frequency of allele $A$, $p_A = \frac{x_A}{x_A + x_B}$, and its variance as
\begin{align}
  \Expect[p_A'] &= \frac{W_A p_A }{W_A p_A + W_B p_B} = \frac{W_A}{\bar{W}}p_A,\\
  \Var[p_A'] &= \frac{p_A' (1 - p_A')}{N} \label{eq:allele_variance},
\end{align}
where we have defined the mean fitness $\bar{W} = W_A p_A + W_B p_B$.
This provides a baseline for how fitness changes under fitness dynamics.

To measure the magnitude of selection for a particular allele, we can define the selection coefficient $s$ so that the fitness of $A$ is $W_A = (1+s) W_B$ per generation.
Using our earlier derivation, we can write the expected frequency of the allele $A$ assuming selection coefficient $s$ after $n$ generations of length $\tau$ days

\begin{equation}
  p_A(n) = \frac{(1+s)^{n}p_{A}(0)}{(1+s)^{n}p_{A}(0) + (1 - p_{A}(0))}.
\end{equation}

% \tbc{The subscripting feels a little weird here. You've already used subscript to denote the specific allele ie $p_A$. It looks like it's effectively generation count here? But then shouldn't it be $p_n$ and not $p_{n\tau}$? I get that because it's discrete generations you don't want $p(n)$. Maybe just swap the above from $p_A$ to $p$?}

% MF: Changed this to be consistent with the above.

There are alternative ways to quantify selection.
The methods above used the absolute fitness $W_A$ and $W_B$ to derive selection coefficients $s$ in order to quantify selection.
Alternative models focus on exponentially growing populations.
These approaches have been developed for and applied to modeling SARS-CoV-2 variant turnover.
These models often estimate the relative fitness of variants based on changes in variant frequencies.
\emph{Relative fitness} is the relative capacity for individuals to reproduce in a population.
In exponentially growing populations, we can think about this as the difference between the growth rates.
Where absolute fitness tells us expected number of offspring, relative fitness tells us how variants differ in their capacity to spread.

% \tbc{Clarify the difference between absolute fitness $W_A$ and $W_B$ vs relative fitness of these two alleles. It's almost $s$ right, but quite? It should require the absolute term $W_B$ that $W_A = (1+s) W_B$ entails.}
% MF: I do this a bit later by showing how this definition of relative fitness aligns with $s$.
% MF: For now, I've added a better tie in the previous section and leave the comparison of the two methods for a little down the page.

One model in this vein that has gained popularity for analyzing SARS-CoV-2 variant frequencies and estimating relative fitness is multinomial logistic growth (MLR).
Assuming that each variant has a fixed fitness relative to all others, we can derive a model for variant frequencies over time
\begin{align}
f_{v}(t) = \frac{p_{v}\exp(r_{v}t)}{\sum_{u} p_{u} \exp(r_{u}t)},
\end{align}
where $f_{v}$ is the frequency of variant $v$ in the virus population at time $t$.
Here, $r_{v}$ and $p_{v}$ can be thought of as variant-specific growth rates per day and initial prevalence.
Due to the fact that adding a constant to the growth rates does not affect the frequencies, $r_{v}$ is not uniquely identifiable for all variants.
Additionally, we have the constraint that the initial prevalence of each variant must add to one.
Therefore, we often instead work with a model of the form
\begin{align}
f_{v}(t) = \frac{\exp(\lambda_{v} t + \alpha_{v})}{\sum_{u} \exp(\lambda_{u} t + \alpha_{u})},
\end{align}
where we've set some variant as a pivot with $\lambda_{\text{pivot}} = \alpha_{\text{pivot}}=0$.
By choosing to constrain $\lambda_{\text{pivot}}=0$, we make the model the identifiable.
We've also incorporated the logarithm of the initial prevalence $\log p_v$ into the exponential function as $\alpha_v$, mirroring the form of a generalized linear model.
% \tbc{I'm confused by this. What happened to the initial frequencies $p_v$? It got moved inside the exp to become $alpha_v$? Why do it this way?}
% MF: I gets moved inside for computational reasons basically. It's more complicated to estimate the $p_v$ given they sum to 1.
Using these MLR models, the relative fitness of variant $v$ relative to the pivot is often interpreted as being $\lambda_{v}$.

By using the mean generation time $\tau$, we can approximate the relative effective reproduction number of variants as $R_{t}^{v} / R_{t}^{\text{pivot}} = \exp(\lambda_{v}\tau)$, which is equivalent to assuming that the generation time distribution is a point mass at $\tau$.
This approximation allows us to convert our estimated relative fitness $\lambda_v$ from time in days to a per-generation growth advantage.
% \tbc{Can you say more here about conversion between time in generations vs time in days and what this entails in terms of MLR parameter values?}
We can relate this model of relative fitness to our earlier model of selection by noting that we can convert from number of generations $n$ to number of days $t$ using the generation time, $t = n\tau$.
Substituting the above into our model of selection, we compare the selection coefficient $s$ to the relative fitness $\lambda$,

\begin{equation}
(1 + s)^{t / \tau} = \exp(\lambda_v t) \implies \lambda_v \tau = \log{(1 + s)} \approx s.
\end{equation}

This approximation holds for small $s \approx 0$ using a linear approximation of $\log(1+x)$.
This provides a simple relationship between the traditional selection coefficient $s$ used in population genetics and the relative fitness $\lambda$ that we'll use throughout this dissertation.

\section{Bayesian inference}%

For this general project of relating epidemic dynamics and population genetics, we need to take these models and connect them to what is observed or observable for statistical analysis.
In our case, we rely primarily on Bayesian inference methods.
We'll shortly review several features of Bayesian inference that are useful for this kind of modeling.

In short, Bayesian inference is focused on the properties of the joint probability distribution  $p(\vec{x}, \vec{\theta})$ of data $\vec{x}$ and parameters $\vec{\theta}$ under a given model $m$.

\paragraph{Posterior distribution.}
Given a model and data, we can provide estimates of a possible distribution of parameters conditional on observed data using Bayes rule
\begin{align}
p(\vec{\theta} \mid \vec{x}) = \frac{p(\vec{x} \mid \vec{\theta})\cdot p(\vec{\theta})}{\int p(\vec{x} \mid \vec{\theta}') p(\vec{\theta}') d \vec{\theta}'}.
\end{align}
This distribution is called the \emph{posterior distribution of $\theta$ under model $m$}.
Notice, this distribution depends on both the likelihood of the data given the model parameters $\vec{\theta}$ $p(\vec{x} \mid \vec{\theta})$ and the prior probability of the parameters $p(\vec{\theta})$ before observing data.
These priors are often set as a part of model building and can be useful for regularization, smoothing, and modeling data hierarchically.

\paragraph{Posterior samples allow us to estimate expectations.}%

Most often, we approximate this distribution using samples from the posterior distribution using methods like Markov Chain Monte Carlo or Variational Inference.

These samples allow us to get expectations of function under the posterior distribution, so that we can compute
\begin{align}
\Expect_{p(\vec{\theta} \mid \vec{x})}[f(\vec{\theta})] = \int_{\Theta} f(\vec{\theta}) p(\vec{\theta} \mid \vec{x}) d \vec{\theta}.
\end{align}

These expectations can be used to compute the probability of events under the posterior distribution including distributions for missing or future data.

%MF: Cut section on posterior predictive distribution?
% \paragraph{Posterior predictive distribution.}%

% In addition to the posterior distribution, we're often also interested in the \emph{posterior predictive distribution} which gets the distribution of new data $\vec{x}_{\text{new}}$ under the posterior distribution of $\theta$ i.e. conditioned on the original data set $\vec{x}$
%  \begin{align*}
% p(\vec{x}_{\text{new}} \mid \vec{x}) = \int_{\Theta} p(\vec{x}_{\text{new}} \mid \vec{\theta}) \cdot p(\vec{\theta} \mid \vec{x}) d\vec{\theta} = \Expect_{p(\vec{\theta} \mid \vec{x})}[p(\vec{x}_{\text{new}} \mid \vec{\theta})].
% \end{align*}
% This distribution is useful for analysing how likely observed data is under a given a model.

Using these objects in Bayesian inference allows us to incorporate prior information about a system of interest, estimate parameters accounting for uncertainty in the model and observation, and build models that can be informed by various data sources simultaneously.

\section{Genetic diversity and variant classification}

The classification of viral populations into variants, as seen in systems such as WHO variant labeling, Nextstrain clades, and Pango lineages, plays a central role in making viral evolution interpretable and simplifying communication of infection risk or evolution. \cite{Hadfield2018, aksamentov2021nextclade, Rambaut2020}
% \tbc{Also cite Rambaut et al Nat Microbiology 2020 as canonical reference for Pango lineages.}
These classifications exist not only to monitor viral diversity but also to guide public health decisions, ensuring that responses are grounded in structured simplifications of genetic data.
In this context, variant assignment allows us to collapse the continuous landscape of viral genetic diversity into discrete categories, making it easier to perform population-level analyses and quantify key evolutionary forces, such as selection pressure.

This section will explore how variant assignment provides both a technical framework and a practical method for simplifying viral diversity.
While mathematically related to clustering problems in statistics and machine learning, the utility of variant assignment lies in how it reduces complexity in order to inform viral forecasting, selection quantification, and public health interventions.
We will demonstrate how this approach helps us predict viral evolution and guide real-world decisions.

\paragraph{Variant assignment for simplifying genetic diversity}

In viral populations, genetic diversity is vast and continuous, with sequences differing from one another by a spectrum of mutations. This continuous diversity creates challenges when analyzing population-level traits, such as fitness or transmissibility. Assigning sequences to variants simplifies this diversity by grouping sequences with similar biological properties, allowing for easier analysis without losing critical biological information.
Variant assignment can be formalized using phenotypic metrics.

Let $G$ represent a general metric that captures a relevant trait of sequence $x_i$ such as fitness, transmissibility, or immune escape potential.
By grouping sequences based on these traits and their similarity, we reduce the dimensionality of the viral population, making the population easier to analyze.
Importantly, the purpose of these classifications is to provide meaningful categorizations of genetic diversity that can be used for scientific analysis and public health decision-making.

\paragraph{Minimizing within-variant variance}

Variant assignment relies on minimizing the variability within each variant for the selected phenotypic metric $G(x)$.
This process can be understood as minimizing the within-variant sum of squares (WCSS), which measures how close the sequences within each variant are to the variant’s average trait value.
For a set of variants \( \{V_1, V_2, \dots, V_K\} \), the WCSS is given by

\begin{align}
\text{WCSS} &= \sum_{k=1}^{K} \sum_{x \in V_{k}} (G(x) - \mu_{V_k})^2\\
            &= \sum_{k=1}^{K} \abs{V_k} \Var_{x \sim V_k}[G(x)],
\end{align}
where $\mu_V$ is the centroid of variant metric, representing the average value of the metric for sequences in that variant.

Minimizing WCSS ensures that the variance within each variant is as small as possible, meaning that sequences within a variant are phenotypically similar.
This reduction of genetic diversity into variants can provide a simplified representation of viral populations, facilitating analysis while retaining the critical biological differences needed to understand viral dynamics.
It is important to note that minimizing phenotypic variance within a cluster does not necessarily mean that sequences form a proper clade.
In practice, we may want to produce evolutionarily meaningful clades that also minimize phenotype variance.

\paragraph{Simplifying Population-Level Expectations Using Variants}

One of the key advantages of variant assignment is that it simplifies population-level questions, such as estimating the average fitness or transmissibility of the population. 
Directly analyzing every sequence in the population is computationally impractical, particularly as viral diversity grows. Assigning sequences to variants allows us to approximate population-level statistics using variant-level summaries.

For example, to estimate the expected value of a phenotypic trait $G(x)$ (such as fitness) across the population, the exact expectation is given by

\begin{equation}
  \Expect_{X_t}[G] = \int_{\mathcal{X}} G(x) p_{X_{t}}(x) dx,
\end{equation}
where $p_{X_t}(x)$ is the probability density of sequences at time $t$.

By assigning sequences to variants, we can approximate this expectation using variant frequencies $f_{v}(t)$ and an estimate of average trait value $\overline{G}_{v}$ within variant $v$.
The average trait value approximates $\Expect_{X_t \mid V=v}[G]$ and can be estimated with a statistical model or taken from sample averages.
This gives us an approximation
\begin{equation}
  \Expect_{X_t}[G] \approx \sum_{u} f_{u}(t) \overline{G}_u,
\end{equation}
for the expected phenotype across the population, which reduces a potentially complex integral into a weighted sum of variant means.
This allows us to estimate expectations of variant phenotypes without sequence-level phenotype predictions or a generative sequence model $p_{X_t}(x)$.
Instead, we operate at the level of variant.

\paragraph{Error Bounds and Limitations}

How well this approximation works depends on how similar the sequences within the variant are with respect to the trait $G$. 
We can see this by developing a bound 
\begin{align}
  \epsilon &= \abs{\Expect_{X_t}[G]  - \sum_{u} \overline{G}_u f_{u}(t)}^2\\ 
           &= \abs{\sum_{u=1}^{K} (\Expect_{X_{t} \mid V=u}[G] - \overline{G}_u) f_u(t)}^2,
\end{align}
on the error of this approximation.

We can introduce a per-variant mean squared error as 
\begin{align}
  \epsilon_v &= \Expect_{X_{t} \mid V=v}[(G(x) - \overline{G}_v)^2]\\
           &= \Expect_{X_{t} \mid V=v}[\left(G(x) - \Expect_{X_{t} \mid V=v}[G] + \Expect_{X_{t} \mid V=v}[G] - \overline{G}_v\right)^2 ]\\
           &= \Var_{X_{t} \mid V=v}[G] + (\Expect_{X_t \mid X=v}[G] - \overline{G}_v)^2,
\end{align}
which depends on the intrinsic variance of the phenotype within the variant and the squared bias in the estimated mean phenotype of the variant.
Using that the probability of each variant is equal to its frequency $f_v(t)$, we can bound the total error with the Cauchy-Schwarz inequality

\begin{align}
  \epsilon  &= \abs{\sum_{u} (\Expect_{X_{t} \mid V=u}[G] - \overline{G}_u) f_u(t) }^2\\
            &\leq \underbrace{\left(\sum_{u} f_u(t) \right)}_{=1} \left(\sum_{u}  \underbrace{(\Expect_{X_{t} \mid V=u}[G] - \overline{G}_u)^2}_{\epsilon_u} f_u(t)\right)\\
            &\leq \sum_{u} \epsilon_u f_u(t).
\end{align}

This shows our approximation exhibits a bias-variance trade-off.
For unbiased estimates of the mean variant phenotype, this approximation will be most accurate when the within-variant variance is minimized and the variants are well-separated in the phenotypic space.
If the variance of the phenotype within a variant is too large, the mean phenotype may no longer represent all sequences within the variant.
Bounding the error of this approximation, by comparing the variant-level approximation to the exact population-level calculation, provides a deeper understanding of when the simplification works well and when it may fail.
In practice, reassigning sequences or refining the metric might be necessary to maintain the effectiveness of the variant assignment.

\paragraph{Application to Viral Forecasting and Selection}

The broader significance of variant assignment lies in how it supports viral forecasting and the quantification of selection pressures.
By grouping sequences into variants, we can more easily track how traits such as fitness or transmissibility evolve over time and predict future changes in the viral population.

For example, in the context of viruses like SARS-CoV-2 or influenza, where selection plays a significant role in shaping the population, we may choose variants so that we minimize fitness variation within a variant.
This allows us to quantify how selection acts on different variants by tracking changes in the variant frequencies over time.
Variants with higher fitness values will increase in frequency, allowing us to forecast which variants are most likely to dominate future populations.
Moreover, this framework can support public health interventions.
By identifying the variants that are under the strongest selective pressure or are most likely to spread, we can make informed decisions about vaccine updates, mitigation strategies, and resource allocation.

Variant assignment, then, provides a powerful tool for simplifying the analysis of viral populations.
By collapsing genetic diversity into variants, we can approximate population-level expectations using variant-level summaries, significantly reducing the complexity of the analysis.
This approach also supports the broader goals of viral forecasting and public health, as it allows us to track how selection pressures shape the viral population over time at scale without requiring the entire sequence for each sample.
In practice, phenotypes can be taken as molecular measurements such as neutralization titers against human sera, immune escape computed from deep mutational scanning assays, ACE-2 binding, numbers of mutations in particular regions of the genome, or multi-dimensional sequence-based embeddings. \cite{Jian2023, Dadonaite2023, greaney2022antibody, Nanduri2024}
For pathogens like SARS-CoV-2 or influenza, where selection plays a critical role, using fitness as a metric for assessing the fidelity of variant assignment helps simplify evolutionary dynamics and predict future changes in the viral population while minimizing approximation error.

\section{Evolutionary forecasting and its components}%

With these preliminaries, we now identify several steps towards our goal of mechanism-informed evolutionary forecasting of viruses.

Understanding how viral populations evolve over time is essential for public health interventions, vaccine development, and pandemic preparedness. 
Evolutionary forecasting provides the tools to predict how variant frequencies will change in response to selective pressures, mutation, and genetic drift.

I'll begin by describing the major targets of evolutionary forecasting mathematically using models of frequency change.
This requires describing the population genetic forces that underlie frequency change and evolution.
Though we've focused on selection thus far, it is important to note that selection coexists with genetic drift and mutation.

Genetic drift quantifies the randomness in frequency change due to demographic stochasticity impacting reproduction between generations.
This is represented in our early model of allele frequency change by the variance of the frequency of allele $A$ in the next generation $p_A'$.
In equation \ref{eq:allele_variance}, we can see the variance between generation decreases as the population size $N$ increases.
In general, the magnitude of the genetic drift depends on the effective population size $N_e$, which acts similarly to $N$, but accounts for factors like unequal contribution to the next generation, overlapping generations, and changes in the population size over time, which are extremely relevant for viral populations.
This effective population size $N_e$ is an important feature of population genetic models and is often used as a proxy for prevalence in coalescent-based phylodynamic analyses, though assumption on the generation time $\tau$ are necessary to isolate $N_e$. \cite{MullerWagner2021}

\paragraph{Simplifying to variant-level dynamics}

We begin by considering a population of viral sequences over time $X_t$.
Through genomic surveillance, we can sample from the distribution of viruses to observe sequences $x_t^{(1)}, \ldots, x_t^{{N_t}} \sim X_t$.

We use stochastic differential equations (SDEs) motivated by our earlier results to model the evolution of this virus.
If we assume that genotype $x$ has frequency $f(x, t)$, we can model the change in frequency of that genotype as

\begin{equation}
  df_x(t) = \underbrace{\left[\lambda_{x}(t) - \bar{\lambda}(t)\right] f_x(t) dt}_{\text{selection}} + \underbrace{\sigma(x, t) d\vec{W}_{t}}_{\text{drift}} + \underbrace{\mu \frac{\partial^2 }{\partial x^2} f(x,t) dt}_{\text{mutation}},
\end{equation}
where $\lambda_x(t)$ is the fitness of genotype $x$ at time $t$, $\bar{\lambda}(t) = \int_{\mathcal{X}} \lambda_z(t)\cdot f_z(t) dz$ is the mean fitness in the population at time $t$.
We also have $\sigma(x, t) = \sqrt{\frac{f(x,t) (1 - f(x,t))}{N_e}}$, which captures genetic drift, i.e., the random fluctuations in the frequency due to randomness in reproduction.
Lastly, we have a diffusion term, $\mu \frac{\partial^2 }{\partial x^2} f(x,t) dt$, which describes the diffusion of frequency across genotype space due to mutation with $\mu$ as the mutation rate.

By leveraging the variant assignment framework introduced earlier, we can simplify our models by tracking the dynamics among variants to predict future changes in viral populations.
Our SDEs are reduced to a system of $V$ equations representing each variant

\begin{equation}
  df_v(t) = \left[\lambda_{v}(t) - \bar{\lambda}(t)\right] f_v(t) dt + \vec{\Sigma} d\vec{W}_{t},
\end{equation}
where I've now dropped the mutation term.
This reduced system of equations depends on the variant level fitnesses over time, the mean fitness $\bar{\lambda}(t) = \sum_{u} \lambda_u(t)\cdot f_u(t)$, and a $V \times V$ covariance matrix $\Sigma$ for genetic drift.
The covariance matrix $\Sigma$ for the genetic drift between variants has elements
\begin{equation}
\Sigma_{ij} = \begin{cases}
  \frac{f_i (1 - f_i)}{N_e}, & \text{if } i = j, \\
  -\frac{f_i f_j}{N_e}, & \text{if } i \neq j.
\end{cases}
\end{equation}
This captures the variance of each variant ($i = j$) and the negative covariance between variants ($i \neq j$) due to the finite population constraint.

This suggests that, instead of working with continuous genotypes, we may be able to model factors like selection and genetic drift by looking at variant-level data.
Thinking about frequency change in the population in terms of variant frequency drastically simplifies analysis since we only need labels of variant status over time instead of full sequences, enabling analysis at a much larger scale.

\paragraph{The components of evolutionary forecasting}

Understanding and forecasting viral evolution requires integrating genetic diversity, fitness estimation, and population-level dynamics into a cohesive framework.
We'll now outline the essential components of this process, highlighting how these elements interact to enable forecasts of variant dynamics.

The first step in evolutionary forecasting is summarizing genetic diversity in a way that captures key patterns  while enabling fitness estimation.
Genetic diversity reflects the interplay of selection, drift, and mutation in shaping frequency.

When quantifying genetic diversity in practice, we typically work with variant classifications and the frequencies of these variants as summaries of this genetic diversity.
These variant frequencies are the foundation of these forecasts as they reflect the fitness of these variants, the stochastic effects of genetic drift, and diversification within a variant due to mutation.

Relative fitness estimation is central to evolutionary forecasting and a central task of this dissertation.
Beyond merely estimating relative fitness, we seek to contextualize relative fitness with the mechanisms that drive it and use these ideas to predict the population-level impact of evolution.

Understanding the biological basis for fitness differences is essential for forecasting.
Mediated by mutations in viral proteins that enable evasion of host immunity or enhance binding affinity, viral characteristics like immune escape or transmissibility underpin relative fitness advantages and can cause large waves of infection.

The relative fitness is also context-dependent, influenced by past infection and exposure, spatial heterogeneity, and waning immunity within a population.
These forms of population structure introduce complex spatial and temporal dynamics into evolutionary forecasts.
To account for this, we need to assess how population structure affects relative fitness in real-time and how this will carry into the future.

Evolutionary forecasting is inherently uncertain, complicated by mutation, genetic drift, and changing population structure.
By combining these elements, we can potentially improve our estimates and forecasts of relative fitness and project changes in variant frequencies over time, capturing both short-term and long-term dynamics.

As we continue to improve our methods for forecasting, what remains is to develop evolutionary forecasting as a practice.
This requires ensuring that we have the data, methods, and software tools needed to produce forecasts in real-time, quantify their uncertainty, and communicate these results.

\section{Overview of chapters and contributions}

This dissertation develops fitness-based models by integrating epidemiological data, population genetics, and Bayesian methods for understanding, modeling, and forecasting viral evolution. 

The chapters progress from mechanistic models that jointly estimate transmission and evolutionary dynamics to data-driven, mechanism-informed models incorporating external data for long-term forecasting.
Each chapter contributes to building a comprehensive framework for understanding and predicting the spread of viral variants in pathogens such as SARS-CoV-2.

\paragraph{Chapter 2: Inferring variant-specific effective reproduction numbers from combined case and sequencing data}

In this chapter, we develop a model that jointly estimates variant-specific reproduction numbers ($R_t$) and relative fitness.
The integration of case and sequencing data allows us to make statements about both transmission rates and evolutionary dynamics simultaneously.
This mechanistic framework provides deeper insights into the joint behavior of evolution and transmission.

\noindent\textbf{Key contributions}:
\begin{itemize}
  \item We integrate case data and sequencing data to model evolution and transmission jointly, offering real-time insights into how variants spread and evolve under different conditions.
  \item We develop a model that jointly estimates both variant-specific effective reproduction numbers and relative fitness capturing the interaction between evolutionary dynamics and transmission rates.
  \item We set the stage for models in later chapters that will refine the understanding of transmission and immunity by linking these processes to fitness.
\end{itemize}

\paragraph{Chapter 3: Fitness models provide accurate short-term forecasts of SARS-CoV-2 variant frequency}

This chapter develops a framework and pipeline for evaluating fitness-based models of short-term evolutionary forecasts like those developed in Chapter 2.
The emphasis is on assessing the performance of statistical models and the importance of data quality and sequencing capacity in improving forecast accuracy.

\noindent\textbf{Key contributions}:
\begin{itemize}
        \item We develop a framework and pipeline for evaluating MLR models and other fitness-based models in the context of short-term forecasting, focusing on forecast accuracy and reliability.
        \item We show the limitations of statistical models for longer-term forecasts, emphasizing the need for more comprehensive approaches.
        \item We identify the role of data quality and sequencing capacity in enabling accurate forecasts, suggesting that a minimum of 1,000 sequences per week is necessary for reliable short-term predictions.
        \item We set the stage for models in later chapters that will integrate external data to improve forecast reliability by better capturing transmission mechanisms and immune escape.
\end{itemize}

This chapter provides a rigorous evaluation of fitness-based forecasting models and emphasizes the importance of data collection and integration in producing accurate short-term forecasts.

\paragraph{Chapter 4: Frequency dynamics predict viral fitness, antigenic relationships and epidemic growth}

Building on the insights from Chapters 2 and 3, this chapter develops a comprehensive framework that combines epidemiological theory and population genetics to estimate time-varying relative fitness.
This chapter introduces several contributions, including a selective pressure metric, a latent factor model, and a focus on immune escape as a critical factor for explaining fitness dynamics and viral evolution.

\noindent\textbf{Key contributions}:
\begin{itemize}
  \item We develop a Gaussian Process model for estimating time-varying relative fitness, to track how variants evolve in real-time regardless of underlying mechanism.
  \item We derive a selective pressure metric, which predicts epidemic growth rates without the need for case data, based solely on genetic data.
  \item We develop a latent factor pseudo-immune model, which constructs a pseudo-antigenic space, allowing for comparisons of immunity differences between populations and informing forecasts about antigenic evolution.
\end{itemize}

This chapter provides a deeper understanding of how transmission mechanisms and immune escape influence viral evolution, offering critical insights for improving the forecasting of variant success.

\paragraph{Chapter 5: Forecasting SARS-CoV-2 lineage success from molecular data}

Building on the constraints and limitations identified in Chapters 3 and 4, this chapter develops a novel framework that integrates molecular phenotypes with relative fitness innovations to forecast the success of SARS-CoV-2 variants.
By leveraging deep mutational scanning data, these models provide a mechanism-informed approach to disentangle the effects of shared ancestry and quantify the contributions of immune escape and transmissibility-related traits to lineage success.

\noindent\textbf{Key contributions}:
\begin{itemize}
  \item  We develop a framework that integrates molecular phenotype data with fitness innovations to quantify and predict lineage success.
  \item We introduce a regression-based prior for fitness that enables out-of-sample forecasting of relative fitness for unseen variants, extending models introduced in earlier chapters.
  \item We demonstrate that immune escape is the dominant phenotypic driver of fitness, while transmissibility-related traits such as ACE2 binding affinity and RBD expression also contribute.
  \item We validate our framework’s predictive accuracy, highlighting its potential for real-time monitoring and broader application to other rapidly evolving pathogens.
\end{itemize}

This chapter advances the field by providing a scalable, data-driven framework that combines molecular phenotypes with evolutionary modeling to improve forecasting of lineage success.
Its applications extend beyond SARS-CoV-2, offering insights into antigenic evolution and supporting public health decision-making through proactive variant surveillance.

\paragraph{Chapter 6: Operationalizing evolutionary forecasts: \evofr\ and \forecastsNcov}

Using the theoretical and statistical grounding developed in previous chapters, this chapter develops and describes software that takes evolutionary forecasting from a series of one-off analyses to a practice.
The software tools \evofr\ and \forecastsNcov\ move evolutionary forecasts from a series of bespoke analyses on relative fitness and variant frequency to a tool kit for rapidly implementing these analyses and a reproducible workflow for real-time monitoring and forecasting SARS-CoV-2 evolution in practice.

\noindent\textbf{Key contributions}:
\begin{itemize}
  \item We develop a Python package \evofr\ that implements many of the tools needed to analyze and forecast variant frequency change and estimate relative fitness.
  \item We develop an automated and reproducible workflow \forecastsNcov\ for producing and visualizing forecasts of SARS-CoV-2 variant evolution.
\end{itemize}

This chapter operationalizes evolutionary forecasting, transforming the discipline from a series of scientific analyses to a dynamic process for predicting pathogen evolution using genomic surveillance data.

\paragraph{Chapter 7: Conclusions and Future Work}

This chapter synthesizes the contributions of the previous chapters and explores potential directions for future research.
It highlights how the development of data-driven and mechanism-informed models sets the stage for further advances in viral forecasting, including future integration of external data sources and the application of generative sequence models to evolutionary forecasting.

I summarize how the work in this dissertation advances viral forecasting by developing models that integrate epidemiological data, population genetics, and Bayesian inference.
Next, I propose future research directions, including the integration of external data sources to refine and evaluate forecasting models, the application of these models to other viral families, and the development of generative sequence models for evolutionary forecasting.
This concludes the dissertation by offering a vision for the future of evolutionary forecasting of viruses.
